<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="post_upgrade_encrypt_passwords" model="ir.cron">
        <field name="name">Post upgrade encrypt passwords</field>
        <field name="interval_number">1</field>
        <field name="interval_type">hours</field>
        <field name="numbercall">-1</field>
        <field name="model_id" ref="base.model_res_users"/>
        <field name="state">code</field>
        <field name="code">
env.cr.execute(
    """
        SELECT id, password FROM res_users
         WHERE password IS NOT NULL
           AND password !~ '^\$[^$]+\$[^$]+\$.'
         LIMIT 10000
    """
)
if env.cr.rowcount:
    Users = env["res.users"].sudo()
    passwords = env.cr.fetchall()
    n = 100
    for i in range(0, len(passwords), n):
        for uid, pw in passwords[i:i + n]:
            Users.browse(uid).write({"password": pw})
        env.cr.commit()

        </field>
    </record>
</odoo>
